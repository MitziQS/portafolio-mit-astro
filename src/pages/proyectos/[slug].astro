---
// src/pages/proyectos/[slug].astro
import { getCollection } from 'astro:content'
import Button from '@components/Button.astro'
import Layout from '../../layouts/Layout.astro'

export async function getStaticPaths() {
  const projects = await getCollection('projects')
  return projects.map((p) => ({
    params: { slug: p.slug },
    props: { project: p }
  }))
}

const { project } = Astro.props
const { Content } = await project.render()

const options = {
  title: project.data.title,
  description: project.data.summary || ''
}
---

<Layout {options}>
  <section class="projects section">
    <div class="project-wrapper">
      <!-- ✅ BOTÓN REGRESAR -->
      <Button
        href={`${import.meta.env.BASE_URL}#proyectos`}
        class="small"
        onclick="if (history.length > 1) { history.back(); return false; }"
      >
        ← Regresar
      </Button>

      <!-- ✅ TÍTULO -->
      <header class="project-hero">
        <h1 class="project-title">{project.data.title}</h1>
      </header>

      <!-- ✅ HERO IMG -->
      {
        project.data.cover && (
          <figure class="project-media">
            <img
              src={project.data.cover}
              alt={project.data.coverAlt ?? project.data.title}
              loading="eager"
            />
          </figure>
        )
      }

      <!-- ✅ CONTENIDO -->
      <article class="project-content">
        <Content />
      </article>
    </div>
  </section>

  <style>
    /* ✅ Wrapper centrado */
    .project-wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    /* ✅ Botón regresar */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      text-decoration: none;
      border: 1px solid currentColor;
      border-radius: 999px;
      padding: 0.4rem 0.85rem;
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 1rem;
    }
    .back-link:hover {
      opacity: 1;
    }

    /* ✅ Título */
    .project-title {
      margin-top: 0.5rem;
      margin-bottom: 1.5rem;
      line-height: 1.1;
    }

    /* ✅ Imagen */
    .project-media img {
      width: 100%;
      border-radius: 12px;
      display: block;
      margin-bottom: 2rem;
    }

    /* ✅ Márgenes del contenido */
    .project-content :is(h2, h3) {
      margin-top: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .project-content > * + * {
      margin-top: 1rem;
    }
  </style>
</Layout>
